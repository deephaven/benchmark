# Run benchmarks on a remote system according to 
# resources/release-benchmark-docker-compose.yml
# - Calls the reusable worflow remote-benchmarks.yml
# - Used for testing the full workflow without affecting 
#   permanent data in other categoriees (like release, nightly)
# - Produces temporary data that is not preserved long term 

name: Adhoc Benchmark Test on Docker Deephaven

on:
  workflow_dispatch:
   inputs:
     docker_image:
       description: 'Docker Image Name'
       type: string
       required: true
       default: 'edge'
     run_label:
       description: 'Run Label'
       type: string
       required: true
     test_package:
       description: 'Benchmark Test Package'
       type: string
       required: true
       default: 'io.deephaven.benchmark.tests.standard'
     test_class_regex:
       description: 'Benchmark Test Class Pattern'
       type: string
       required: true
       default: '^.*[.]MixedCombo.*Test.*$'
     scale_row_count:
       description: 'Benchmark Scale Row Count'
       type: string
       required: true
       default: '1000000'
     distribution:
        description: 'Benchmark Data Distribution'
        type: choice
       	default: 'random'
        options: 
        - random
        - ascending
        - descending
        - runlength

jobs:
  process-release-benchmarks:
    if: ${{github.repository_owner != 'deephaven'}}
    uses: ./.github/workflows/remote-benchmarks.yml
    with:
      run_type: adhoc
      docker_image: ${{ inputs.docker_image }}
      run_label: ${{ inputs.run_label }}
      test_package: ${{ inputs.test_package }}
      test_class_regex: ${{ inputs.test_class_regex }}
      scale_row_count: ${{ inputs.scale_row_count }}
      distribution: ${{ inputs.distribution }}
    secrets: inherit


